# compiler settings
CXX = clang++
CXXFLAGS = -I . -std=c++2a -I include

FAN_OBJECT_FOLDER =
IMGUI_PATH =
OUTPUT_PATH = lib/fan/

WINDOWS_ROOT_PATH = ./
LINUX_ROOT_PATH = ./include/

FAN_INCLUDE_PATH =

DEBUG_FLAGS = -g
RELEASE_FLAGS = -mmmx -msse -msse2 -msse3 -mssse3 -msse4 -msse4.1 -O3 -fdata-sections -ffunction-sections

OUT_FILE_FORMAT =

INCLUDES =
ifeq ($(OS),Windows_NT)
	FAN_INCLUDE_PATH += $(WINDOWS_ROOT_PATH)include/
	INCLUDES += -I $(WINDOWS_ROOT_PATH)include/fan/imgui
	CXXFLAGS += -DWITCH_INCLUDE_PATH=$(WINDOWS_ROOT_PATH)WITCH
	IMGUI_PATH += include/fan/imgui/
	OUT_FILE_FORMAT+=lib
else
	FAN_INCLUDE_PATH += $(LINUX_ROOT_PATH)
	INCLUDES += -I $(LINUX_ROOT_PATH)fan/imgui -I $(LINUX_ROOT_PATH)WITCH
	CXXFLAGS += -DWITCH_INCLUDE_PATH=/usr/include/WITCH
	IMGUI_PATH += $(LINUX_ROOT_PATH)fan/imgui/
	OUT_FILE_FORMAT+=a
endif

CXXFLAGS += -DFAN_INCLUDE_PATH=$(FAN_INCLUDE_PATH)

#todo remove
INCLUDES += -I include

#note
CXXFLAGS += $(DEBUG_FLAGS)

PCH_NAME = pch.h
CXXFLAGS += -Dfan_pch=\"$(FAN_INCLUDE_PATH)fan/$(PCH_NAME)\"

%.o: %.cpp
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# source files and output
IMGUI_SRC = $(wildcard $(IMGUI_PATH)*.cpp)
IMGUI_OBJ = $(IMGUI_SRC:.cpp=.o)
IMGUI_LIB = libimgui.$(OUT_FILE_FORMAT)

$(IMGUI_LIB): $(IMGUI_OBJ)
	llvm-ar rcs $(OUTPUT_PATH)$@ $^

clean:
ifeq ($(OS),Windows_NT)
	del $(IMGUI_PATH)*.o
	del $(IMGUI_LIB)
else
	rm $(IMGUI_PATH)*.o
endif
